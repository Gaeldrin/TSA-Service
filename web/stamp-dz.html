<!DOCTYPE html>
<!--

-->
<html>
    <head>
        <meta charset="UTF-8">
        <title>CESNET</title>
<!--        
        <meta name="description" content="File upload">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        -->
        <script src="js/dropzone.js"></script>
        <link rel="stylesheet" href="css/dropzone.css">
    </head>
    <body>
        <h1>CESNET TSA JSP Service</h1>
        <h2>HTML version</h2>
        
        <hr>
        
        <h3>Vyberte soubor k orazítkování</h3>
        <form action="stamping.jsp" class="dropzone" id="file-upload" method="POST" enctype="multipart/form-data"> <!-- >-->
            <script>
                // NOTES: amazing plugin, but works only with AJAX... :(
                
                // "fileUpload" is the camelized version of the HTML element's ID
                Dropzone.options.fileUpload = {
                  paramName: "filename", // The name that will be used to transfer the file
                  maxFilesize: 300, // MB
                  maxFiles: 1,
                  uploadMultiple: true,
                  addRemoveLinks: true,
                  
                  // česká lokalizace
                  dictDefaultMessage: "Sem přetáhněte soubor.",
                  dictFallbackMessage: "Váš prohlížeč je zastaralý nebo nepodporuje JavaScript, funkčnost stránky byla omezena!",
                  dictMaxFilesExceeded: "Nelze orazítkovat více souborů najednou!",
                  
//                  forceFallback: true, // debug
                  
                  // Prevents Dropzone from uploading dropped files immediately
                  autoProcessQueue: false,

                  init: function() {
                      
                    var submitButton = this.element.querySelector("button[type=submit]");
                    submitButton.style.visibility='hidden';
                    var dropzone = this; // closure

//                    submitButton.addEventListener("click", function() {
                    // First change the button to actually tell Dropzone to process the queue.
                    this.element.querySelector("button[type=submit]").addEventListener("click", function(e) {
                      // Make sure that the form isn't actually being sent.
                      e.preventDefault();
                      e.stopPropagation();
                      dropzone.processQueue(); // Tell Dropzone to process all queued files.
                    });
                    
                    // Listen to the sendingmultiple event. In this case, it's the sendingmultiple event instead
                    // of the sending event because uploadMultiple is set to true.
                    this.on("sendingmultiple", function() {
                      // Gets triggered when the form is actually being sent.
                      submitButton.style.visibility='hidden';
                    });
                    this.on("successmultiple", function(files, response) {
                      // Gets triggered when the files have successfully been sent.
                      // Redirect user or notify of success.
                      console.log(files);
                      console.log(response);
                      window.location.replace("/stamping.jsp");
                    });
                    this.on("errormultiple", function(files, response) {
                      // Gets triggered when there was an error sending the files.
                      // Maybe show form again, and notify user of error
                    });

                    // You might want to show the submit button only when 
                    // files are dropped here:
                    this.on("addedfile", function() {
                      // Show submit button here and/or inform user to click it.
                      submitButton.style.visibility='visible';
                    });
                    
                    // remove thumbnail for extra files
                    this.on("maxfilesexceeded", function(file) {
                        this.removeFile(file);
                    });

                  }
                
                
                };
            </script>
            
            <div class="dropzone-previews"></div> <!-- this is were the previews should be shown. -->
            
            <br>
            
            <div class="fallback">
                <input type="file" name="filename" />
                <!--<input type="submit" />-->
            </div>
            
            <button id="button" type="submit">Odeslat</button>
        </form>
        <br>
        <br>
        <br>
        <br>
        <hr>
        <i><a href="index.html">Návrat na hlavní stránku</a></i>
    </body>
</html>
